package com.exploit.exploitxxe;

import java.io.*;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.xml.sax.InputSource;

@WebServlet("/exploit")
public class XXEServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        try {
            // 读取 XML 数据
            BufferedReader reader = request.getReader();
            StringBuilder xmlData = new StringBuilder();
            String line;
            while ((line = reader.readLine()) != null) {
                xmlData.append(line);
            }

            // 创建存在 XXE 漏洞的 XML 解析器
            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            DocumentBuilder builder = factory.newDocumentBuilder();

            // 解析 XML
            Document document = builder.parse(new InputSource(new StringReader(xmlData.toString())));

            // 获取解析后的 XML 数据
            String parsedData = document.getDocumentElement().getTextContent();

            // 输出响应
            response.setContentType("text/plain");
            response.getWriter().write("Parsed XML: " + parsedData);

        } catch (Exception e) {
            e.printStackTrace();
            response.getWriter().write("Error: " + e.getMessage());
        }
    }
}